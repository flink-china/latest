<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.2 Documentation: JobManager的高可用 (HA)</title>
    <link rel="shortcut icon" href="/1.2.0/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/1.2.0/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="/1.2.0/page/css/flink.css">
    <link rel="stylesheet" href="/1.2.0/page/css/syntax.css">
    <link rel="stylesheet" href="/1.2.0/page/css/codetabs.css">
    <link rel="stylesheet" href="/1.2.0/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3">
          







  
    
    
    
      
    
  

  
    
    
    
      









  





<div class="sidenav-logo">
  <p><a href="/1.2.0"><img class="bottom" alt="Apache Flink" src="/1.2.0/page/img/navbar-brand-logo.jpg"></a> v1.2</p>
</div>
<ul id="sidenav">

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/index.html"><i class="fa fa-home title" aria-hidden="true"></i> 首页</a></li>
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> 概念 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/1.2.0/concepts/programming-model.html">编程模型</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/setup_quickstart.html"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> 快速起步</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> 示例 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  <li><a href="/1.2.0/examples/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/run_example_quickstart.html">Monitoring Wikipedia Edits</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/examples.html">Batch Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-11" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> 建立工程 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-11"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/java_api_quickstart.html">Java 的样例工程</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/scala_api_quickstart.html">Scala 的样例工程</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/linking_with_flink.html">Linking with Flink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/ide_setup.html">IDE Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/scala_shell.html">Scala REPL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/linking.html">关联可选模块</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-21" data-toggle="collapse"><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-21"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-22" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-22"><ul>
  <li><a href="/1.2.0/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/java8.html">Java 8</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-26" data-toggle="collapse">Streaming (DataStream API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-26"><ul>
  <li><a href="/1.2.0/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/1.2.0/dev/windows.html">Windows</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-28" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-28"><ul>
  <li><a href="/1.2.0/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/event_timestamp_extractors.html">预定义的 Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-32" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-32"><ul>
  <li><a href="/1.2.0/dev/connectors/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/process_function.html">过程函数</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/state.html">Working with State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/asyncio.html">Async I/O</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/queryable_state.html">Queryable State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-50" data-toggle="collapse">批 (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-50"><ul>
  <li><a href="/1.2.0/dev/batch/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/python.html">Python API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-61" data-toggle="collapse">数据类型和序列化 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-61"><ul>
  <li><a href="/1.2.0/dev/types_serialization.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-64" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-64"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/parallel.html">并行执行</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/execution_plans.html">执行计划</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-71" data-toggle="collapse">Libraries <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-71"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/table_api.html">Table and SQL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/cep.html">Event Processing (CEP)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/storm_compatibility.html">Storm Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-75" data-toggle="collapse">Graphs: Gelly <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-75"><ul>
  <li><a href="/1.2.0/dev/libs/gelly/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-83" data-toggle="collapse">机器学习 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-83"><ul>
  <li><a href="/1.2.0/dev/libs/ml/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/quickstart.html">快速入门</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/multiple_linear_regression.html">多元线性回归</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/cross_validation.html">交叉验证</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/distance_metrics.html">距离度量</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/knn.html">K近邻算法（KNN）</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/min_max_scaler.html">最小最大值标准化</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/contribution_guide.html">贡献指南</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/polynomial_features.html">多项式特征转换</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/standard_scaler.html">标准化缩放</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/svm.html">支持向量机（SVM using CoCoA）</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-102" data-toggle="collapse" class="active"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> 部署与运维</a><div class="collapse in" id="collapse-102"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/1.2.0/setup/config.html">Configuration</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/cli.html">CLI</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-105" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-105"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/yarn_setup.html">YARN</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/mesos.html">Mesos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/aws.html">AWS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/mapr_setup.html">MapR</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/jobmanager_high_availability.html" class="active">High Availability (HA)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/savepoints.html">Savepoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/ops/production_ready.html">生产环境检查清单</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-121" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> 调试与监控 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-121"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/logging.html">Logging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/large_state_tuning.html">Debugging and Tuning Checkpoints and Large State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-133" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> 内部原理 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-133"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/components.html">Component Stack</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
<li><a href="/1.2.0/about/index.html"><i class="fa fa-fire title hot" aria-hidden="true"></i> 参与贡献</a></li>
    
  

  
    
      
  <li class="divider"></li>
  <li><a href="http://flink-china.org"><i class="fa fa-external-link title" aria-hidden="true"></i> 项目页面</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="/1.2.0/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="搜索文档">
    </div>
    <button type="submit" class="btn btn-default">搜索</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">选择文档版本
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://doc.flink-china.org/1.1.0/">v1.1</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content">
          

          





  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-sliders title maindish" aria-hidden="true"></i> 部署与运维</li>
  

  
  
    <li class="active">High Availability (HA)</li>
  

</ol>

<h1>JobManager的高可用 (HA)</h1>


<p>JobManager协调每个Flink部署。 它负责 <em>调度</em> 和 <em>资源管理</em>。</p>

<p>默认情况下，每个Flink集群都只一个JobManager节点。 
这样的架构会有<em>单点故障</em>（SPOF）：如果JobManager挂了，则不能提交新的程序，且运行中的程序会失败。</p>

<p>使用JobManager高可用性，集群可以从JobManager故障中恢复，从而避免* SPOF *。 
用户在<strong>standalone</strong>或** YARN集群**模式下，配置高可用性。</p>

<ul id="markdown-toc">
  <li><a href="#standalone" id="markdown-toc-standalone">Standalone模式下集群的高可用</a>    <ul>
      <li><a href="#section" id="markdown-toc-section">配置</a></li>
    </ul>
  </li>
  <li><a href="#yarn-" id="markdown-toc-yarn-">YARN 集群高可用</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">配置</a></li>
    </ul>
  </li>
  <li><a href="#zookeepe" id="markdown-toc-zookeepe">Zookeepe的安全配置</a></li>
  <li><a href="#bootstrap-zookeeper" id="markdown-toc-bootstrap-zookeeper">Bootstrap ZooKeeper</a></li>
</ul>

<h2 id="standalone">Standalone模式下集群的高可用</h2>

<p>Standalone模式（独立模式）下JobManager的高可用性的基本思想是，任何时候都有一个<strong>一个 Master JobManager **，并且</strong>多个Standby JobManagers <strong>。
Standby JobManagers可以在Master JobManager 挂掉的情况下接管集群成为Master JobManager。 
这样保证了</strong>没有单点故障**，一旦某一个Standby JobManager接管集群，程序就可以继续运行。 
Standby JobManager和Master JobManager实例之间没有明确区别。 每个JobManager可以成为Master或Standby节点。</p>

<p>举例，使用三个JobManager节点的情况下，进行以下设置:</p>

<p><img src="/1.2.0/fig/jobmanager_ha_overview.png" class="center" /></p>

<h3 id="section">配置</h3>

<p>要启用JobManager高可用性，必须将<strong>高可用性模式</strong>设置为* zookeeper *，
配置一个** ZooKeeper quorum<strong>，并配置一个</strong>主文件** 存储所有JobManager hostname 及其Web UI端口号。</p>

<p>Flink利用** [ZooKeeper]（http://zookeeper.apache.org）** 实现运行中的JobManager节点之间的<em>分布式协调</em>。 ZooKeeper是独立于Flink的服务，它通过领导选举制和轻量级状态一致性存储 来提供高度可靠的分布式协调。 
有关ZooKeeper的更多信息，请查看“ZooKeeper入门指南”（http://zookeeper.apache.org/doc/trunk/zookeeperStarted.html）。 
Flink包含[安装简单ZooKeeper]（＃bootstrap-zookeeper）的bootstrap脚本。</p>

<h4 id="masters-file-masters">Masters File (masters)</h4>

<p>为了启动集群的高可用（HA），需要配置<code>conf/masters</code>中的* masters *文件  :</p>

<ul>
  <li>
    <p><strong>masters file</strong>: <em>masters file</em> 文件中包含所有启动JobManager节点的hosts，以及对应Web UI的端口号</p>

    <pre>
jobManagerAddress1:webUIPort1
[...]
jobManagerAddressX:webUIPortX
</pre>
  </li>
</ul>

<p>默认情况下，JobManager会选择 <em>随机端口号</em> 作为内部进程通信。我们可以通过修改参数<strong>recovery.jobmanager.port</strong>的值来修改。这个参数的配置接受为单个端口号（比如50010），也可以设置一段范围比如 50000~50025，或者端口号组合（比如50010，50011，50020~50025,50050~50075）。</p>

<h4 id="flink-confyaml">配置文件(flink-conf.yaml)</h4>

<p>为了启动集群的高可用（HA），需要对文件<code>conf/flink-conf.yaml</code>做一下配置：</p>

<ul>
  <li>
    <p><strong>高可用模式</strong> (必须的): 要启用高可用，需要配置文件 <code>conf/flink-conf.yaml</code> 中的 <em>high-availability mode</em> 必须设置为 <em>zookeeper</em>。</p>

    <pre>high-availability: zookeeper</pre>
  </li>
  <li>
    <p><strong>ZooKeeper 仲裁（quorum）</strong> (必须的): 一个<em>ZooKeeper quorum</em> 是一组可以复制的ZooKeeper服务器，提供分布式协调服务。</p>

    <pre>high-availability.zookeeper.quorum: address1:2181[,...],addressX:2181</pre>

    <p>每组 <em>addressX:port</em> 表示一个ZooKeeper服务, Flink必须可通过对应的地址和端口通信。</p>
  </li>
  <li>
    <p><strong>ZooKeeper root</strong> (推荐的): <em>ZooKeeper节点根目录</em>，其下放置所有集群节点的namespace。</p>

    <pre>high-availability.zookeeper.path.root: /flink

</pre>
  </li>
  <li>
    <p><strong>ZooKeeper 命名空间</strong> (推荐的): <em>ZooKeeper节点的命名空间</em>，其中放置了集群所需的所有协调数据。</p>

    <pre>high-availability.zookeeper.path.namespace: /default_ns # important: customize per cluster</pre>

    <p><strong>重要</strong>: 如果您正在运行多个Flink HA群集，则必须为每个群集手动配置单独的命名空间。 默认情况下，Yarn集群和Yarn会话会根据Yarn应用程序ID自动生成命名空间。 可以手动配置覆盖了Yarn中默认配置。 或可以使用-z CLI选项指定命名空间，这样可以反过来覆盖手动配置。</p>
  </li>
  <li>
    <p><strong>存储目录</strong> (required): JobManager的元数据保存在文件系统存储目录* storageDir *中，只有一个指向此状态的指针存储在ZooKeeper中。</p>

    <pre>
high-availability.zookeeper.storageDir: hdfs:///flink/recovery
  </pre>
    <p><code>storageDir</code>存储了所有恢复一个JobManager挂掉所需的元数据。</p>
  </li>
</ul>

<p>配置主机和ZooKeeper quorum后，可以照常使用提供的集群启动脚本。 他们将启动一个HA集群。 请记住，当您调用脚本时 ** ZooKeeper quorum 必须已经启动<strong>，并确保为您启动的每个HA群集配置</strong>单独的ZooKeeper根路径**。</p>

<h4 id="standalone-2jobmanagers">例子: Standalone 集群有2个JobManagers</h4>

<ol>
  <li>
    <p>配置文件 <code>conf/flink-conf.yaml</code> 中的 <strong>high-availability mod 和 ZooKeeper quorum</strong>:</p>

    <pre>
high-availability: zookeeper
high-availability.zookeeper.quorum: localhost:2181
high-availability.zookeeper.path.root: /flink
high-availability.zookeeper.path.namespace: /cluster_one # important: customize per cluster
high-availability.zookeeper.storageDir: hdfs:///flink/recovery</pre>
  </li>
  <li>
    <p>配置<code>conf/masters</code>文件中的<strong>Configure masters</strong>:</p>

    <pre>
localhost:8081
localhost:8082</pre>
  </li>
  <li>
    <p>配置<code>conf/zoo.cfg</code>文件中的 <strong>ZooKeeper server</strong>  (目前只能在每台机器上运行一个ZooKeeper服务器):</p>

    <pre>server.0=localhost:2888:3888</pre>
  </li>
  <li>
    <p>启动** ZooKeeper quorum**:</p>

    <pre>
$ bin/start-zookeeper-quorum.sh
Starting zookeeper daemon on host localhost.</pre>
  </li>
  <li>
    <p><strong>启动一个高可用（HA） 集群</strong>:</p>

    <pre>
$ bin/start-cluster.sh
Starting HA cluster with 2 masters and 1 peers in ZooKeeper quorum.
Starting jobmanager daemon on host localhost.
Starting jobmanager daemon on host localhost.
Starting taskmanager daemon on host localhost.</pre>
  </li>
  <li>
    <p><strong>停止ZooKeeper quorum 和集群</strong>:</p>

    <pre>
$ bin/stop-cluster.sh
Stopping taskmanager daemon (pid: 7647) on localhost.
Stopping jobmanager daemon (pid: 7495) on host localhost.
Stopping jobmanager daemon (pid: 7349) on host localhost.
$ bin/stop-zookeeper-quorum.sh
Stopping zookeeper daemon (pid: 7101) on host localhost.</pre>
  </li>
</ol>

<h2 id="yarn-">YARN 集群高可用</h2>

<p>当运行高可用性的YARN集群时，<strong>我们不运行多个JobManager（ApplicationMaster）节点</strong>，而是只有一个，当YARN挂了会导致这个JobManager重新启动。 具体的行为取决于不同的YARN版本。</p>

<h3 id="section-1">配置</h3>

<h4 id="maximum-application-master-attempts-yarn-sitexml">Maximum Application Master Attempts (yarn-site.xml)</h4>

<p>必须在YARN的配置文件yarn-site.xml 中设置提交应用程序的最大尝试次数:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>yarn.resourcemanager.am.max-attempts<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>4<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;description&gt;</span>
    The maximum number of application master execution attempts.
  <span class="nt">&lt;/description&gt;</span>
<span class="nt">&lt;/property&gt;</span></code></pre></div>

<p>当前YARN版本的默认值为2（表示允许单个JobManager故障）。</p>

<h4 id="application-attempts-flink-confyaml">Application Attempts (flink-conf.yaml)</h4>

<p>除了HA配置(<a href="#configuration">see above</a>), 您必须配置文件<code>conf/flink-conf.yaml</code>中的最大尝试次数:</p>

<pre>yarn.application-attempts: 10</pre>

<p>这意味着应用程序可以在YARN应用程序失败之前重新启动10次。 注意的是“yarn.resourcemanager.am.max-attempts”是应用程序重新启动的上限。 因此，在Flink中设置的应用程序尝试次数不能超过YARN启动的YARN集群设置。</p>

<h4 id="section-2">容器关闭行为</h4>

<ul>
  <li>** YARN 2.3.0 &lt;version &lt;2.4.0 **。 如果应用程序管理器出现故障，则所有容器都将重新启动。</li>
  <li>** YARN 2.4.0 &lt;version &lt;2.6.0 **。 TaskManager容器在应用程序管理器故障时依然保持存活。 这具有的优点是启动时间更快，并且用户不必等待再次获取容器资源。</li>
  <li>** YARN 2.6.0 &lt;= version **：将尝试失败有效期间设置为Flinks的Akka超时值。 尝试失败有效性间隔表示，在系统在一个时间间隔内，应用程序尝试的次数超过最大次数之后，应用程序才被杀死。 这样可以避免耗时长的工作会耗尽其尝试次数。</li>
</ul>

<p style="border-radius: 5px; padding: 5px" class="bg-danger"><b>Note</b>: Hadoop YARN 2.4.0有一个主要漏洞（2.5.0中被修复），应用程序管理器/任务管理器容器（container）重启后，容器无法重启. 查看更多细节<a href="https://issues.apache.org/jira/browse/FLINK-4142">FLINK-4142</a>. 我们建议至少在YARN上使用Hadoop 2.5.0进行高可用性设置.</p>

<h4 id="example-highly-available-yarn-session">Example: Highly Available YARN Session</h4>

<ol>
  <li>
    <p>配置文件 <code>conf/flink-conf.yaml</code> 中的 <strong>high-availability mod 和 ZooKeeper quorum</strong>:</p>

    <pre>
high-availability: zookeeper
high-availability.zookeeper.quorum: localhost:2181
high-availability.zookeeper.storageDir: hdfs:///flink/recovery
high-availability.zookeeper.path.root: /flink
high-availability.zookeeper.path.namespace: /cluster_one # important: customize per cluster
yarn.application-attempts: 10</pre>
  </li>
  <li>
    <p>配置<code>conf/zoo.cfg</code>文件中的 <strong>ZooKeeper server</strong>  (目前只能在每台机器上运行一个ZooKeeper服务器):</p>

    <pre>server.0=localhost:2888:3888</pre>
  </li>
  <li>
    <p><strong>启动 ZooKeeper quorum</strong>:</p>

    <pre>
$ bin/start-zookeeper-quorum.sh
Starting zookeeper daemon on host localhost.</pre>
  </li>
  <li>
    <p><strong>启动 HA-cluster集群</strong>:</p>

    <pre>
$ bin/yarn-session.sh -n 2</pre>
  </li>
</ol>

<h2 id="zookeepe">Zookeepe的安全配置</h2>

<p>如果ZooKeeper使用Kerberos运行在安全模式下，可以根据需要覆盖<code>flink-conf.yaml</code>中的以下配置：</p>

<pre>
zookeeper.sasl.service-name: zookeeper     # 默认是 "zookeeper". 如果ZooKeeper quorum被设置为不同的服务名字. 可以修改该参数
zookeeper.sasl.login-context-name: Client  # 默认是 "Client". 这个参数需要和"security.kerberos.login.contexts"中的一个参数 
</pre>

<p>有关Kerberos安全性的Flink配置的更多信息，请参阅<a href="/1.2.0/setup/config.html">这里</a>.
也可以在<a href="/1.2.0/ops/security-kerberos.html">这里</a> 中进一步了解Flink如何内部设置基于Kerberos的安全性。</p>

<h2 id="bootstrap-zookeeper">Bootstrap ZooKeeper</h2>

<p>如果您没有安装正在运行的ZooKeeper，可以使用Flink附带的帮助脚本。</p>

<p>在<code>conf/zoo.cfg</code>中有一个ZooKeeper配置模板。 可以使用通过把hosts配置到<code>server.X</code>参数中来运行ZooKeeper，其中X是每个服务器的唯一ID：</p>

<pre>
server.X=addressX:peerPort:leaderPort
[...]
server.Y=addressY:peerPort:leaderPort
</pre>

<p>脚本<code>bin / start-zookeeper-quorum.sh</code>将在每个配置的主机上启动一个ZooKeeper服务器。 启动的进程通过Flink包装器启动ZooKeeper服务器，Flink包装器从<code>conf / zoo.cfg</code>读取配置，并确保设置一些所需的参数。 
在生产环境中，建议自己管理ZooKeeper安装。</p>



 <div class="footer">
  发现错误？想参与编辑？
  <a href="https://github.com/flink-china/flink-china-doc/edit/1.2.0/setup/jobmanager_high_availability.md" target="_blank">
    在 Github 上编辑此页！
  </a>
</div>

        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/1.2.0/page/js/flink.js"></script>

   <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?835985ad7943d8c24bc3c1f155b7d4a2";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>

    <!-- Disqus -->
    
  </body>
</html>
