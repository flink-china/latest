<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.2 Documentation: 数据类型和序列化</title>
    <link rel="shortcut icon" href="/1.2.0/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/1.2.0/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="/1.2.0/page/css/flink.css">
    <link rel="stylesheet" href="/1.2.0/page/css/syntax.css">
    <link rel="stylesheet" href="/1.2.0/page/css/codetabs.css">
    <link rel="stylesheet" href="/1.2.0/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3">
          







  
    
    
    
      
    
  

  
    
    
    
      









  





<div class="sidenav-logo">
  <p><a href="/1.2.0"><img class="bottom" alt="Apache Flink" src="/1.2.0/page/img/navbar-brand-logo.jpg"></a> v1.2</p>
</div>
<ul id="sidenav">

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/index.html"><i class="fa fa-home title" aria-hidden="true"></i> 首页</a></li>
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> 概念 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/1.2.0/concepts/programming-model.html">编程模型</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/setup_quickstart.html"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> 快速起步</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> 示例 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  <li><a href="/1.2.0/examples/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/run_example_quickstart.html">Monitoring Wikipedia Edits</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/examples.html">Batch Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-11" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> 建立工程 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-11"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/java_api_quickstart.html">Java 的样例工程</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/quickstart/scala_api_quickstart.html">Scala 的样例工程</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/linking_with_flink.html">Linking with Flink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/ide_setup.html">IDE Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/scala_shell.html">Scala REPL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/linking.html">关联可选模块</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-21" data-toggle="collapse" class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</a><div class="collapse in" id="collapse-21"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-22" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-22"><ul>
  <li><a href="/1.2.0/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/java8.html">Java 8</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-26" data-toggle="collapse">Streaming (DataStream API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-26"><ul>
  <li><a href="/1.2.0/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/1.2.0/dev/windows.html">Windows</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-28" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-28"><ul>
  <li><a href="/1.2.0/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/event_timestamp_extractors.html">预定义的 Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-32" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-32"><ul>
  <li><a href="/1.2.0/dev/connectors/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/process_function.html">过程函数</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/state.html">Working with State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/asyncio.html">Async I/O</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/stream/queryable_state.html">Queryable State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-50" data-toggle="collapse">批 (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-50"><ul>
  <li><a href="/1.2.0/dev/batch/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/python.html">Python API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-61" data-toggle="collapse" class="active">数据类型和序列化</a><div class="collapse in" id="collapse-61"><ul>
  <li><a href="/1.2.0/dev/types_serialization.html" class="active">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-64" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-64"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/parallel.html">并行执行</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/execution_plans.html">执行计划</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-71" data-toggle="collapse">Libraries <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-71"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/table_api.html">Table and SQL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/cep.html">Event Processing (CEP)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/storm_compatibility.html">Storm Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-75" data-toggle="collapse">Graphs: Gelly <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-75"><ul>
  <li><a href="/1.2.0/dev/libs/gelly/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-83" data-toggle="collapse">机器学习 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-83"><ul>
  <li><a href="/1.2.0/dev/libs/ml/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/quickstart.html">快速入门</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/multiple_linear_regression.html">多元线性回归</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/cross_validation.html">交叉验证</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/distance_metrics.html">距离度量</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/knn.html">K近邻算法（KNN）</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/min_max_scaler.html">最小最大值标准化</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/contribution_guide.html">贡献指南</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/polynomial_features.html">多项式特征转换</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/standard_scaler.html">标准化缩放</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/libs/ml/svm.html">支持向量机（SVM using CoCoA）</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-102" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> 部署与运维 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-102"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/1.2.0/setup/config.html">Configuration</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/cli.html">CLI</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-105" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-105"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/yarn_setup.html">YARN</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/mesos.html">Mesos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/aws.html">AWS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/mapr_setup.html">MapR</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/jobmanager_high_availability.html">High Availability (HA)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/savepoints.html">Savepoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/setup/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/ops/production_ready.html">生产环境检查清单</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-121" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> 调试与监控 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-121"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/logging.html">Logging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/large_state_tuning.html">Debugging and Tuning Checkpoints and Large State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-133" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> 内部原理 <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-133"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/components.html">Component Stack</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/1.2.0/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
<li><a href="/1.2.0/about/index.html"><i class="fa fa-fire title hot" aria-hidden="true"></i> 参与贡献</a></li>
    
  

  
    
      
  <li class="divider"></li>
  <li><a href="http://flink-china.org"><i class="fa fa-external-link title" aria-hidden="true"></i> 项目页面</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="/1.2.0/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="搜索文档">
    </div>
    <button type="submit" class="btn btn-default">搜索</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">选择文档版本
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://doc.flink-china.org/1.1.0/">v1.1</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content">
          

          





  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</li>
  

  
  
    <li class="active">数据类型和序列化</li>
  

</ol>

<h1>数据类型和序列化</h1>



<p>Apache Flink 处理数据类型和序列化的方式较特别，包括自带的类型描述，一般类型提取和类型序列化框架。本文档描述这些基本概念并解释背后的相关原理。</p>

<ul id="markdown-toc">
  <li><a href="#flink-" id="markdown-toc-flink-">Flink 中的类型处理</a></li>
  <li><a href="#section" id="markdown-toc-section">常见问题</a></li>
  <li><a href="#flinktypeinformation" id="markdown-toc-flinktypeinformation">FLink的TypeInformation类</a></li>
  <li><a href="#scala-api" id="markdown-toc-scala-api">Scala API中的类型信息</a></li>
  <li><a href="#java-api" id="markdown-toc-java-api">Java API中的类型信息</a></li>
  <li><a href="#kryo-" id="markdown-toc-kryo-">禁用 Kryo 作为备选</a></li>
  <li><a href="#section-2" id="markdown-toc-section-2">使用工厂定义类型信息</a></li>
</ul>

<h2 id="flink-">Flink 中的类型处理</h2>

<p>Flink会尝试推断出在分布式计算过程中被交换和存储的数据类型的大量信息，你可以想象这就像数据库推断表的模式(schema)一样。在大多数情况下，Flink能够完美地推断出所有必须的信息，这些类型信息使得Flink可以做一些很酷的事情：</p>

<ul>
  <li>
    <p>使用POJOs类型并通过推断的字段名字(如：<code>dataSet.keyBy("username")</code>)完成分组(group)/连接(join)/
聚合(aggregate)操作。这些类型信息使得Flink能够提前检查(如拼写错误和类型兼容性)，避免运行时才发现错误。</p>
  </li>
  <li>
    <p>Flink知道的数据类型信息越多，序列化和数据布局方案(data layout scheme) 就越好。这对Flink的内存使用范式（memory usage paradigm）非常重要(无论在堆内还是堆外都可以操作序列化数据，并且使得序列化的开销非常低)</p>
  </li>
  <li>
    <p>最后，这些信息可以将用户从考虑序列化框架的选择和注册类型中解脱。</p>
  </li>
</ul>

<p>一般而言，数据类型的相关信息是在<code>预处理阶段（pre-flight phase）</code>需要，此时程序刚刚调用了 <code>DataStream</code> 和 <code>DataSet</code>，但是还没调用 <code>execute()</code>, <code>print()</code>, <code>count()</code>, 或 <code>collect()</code>方法.</p>

<h2 id="section">常见问题</h2>
<p>用户如果需要介入 Flink 类型框架的话，一般是在遇到下面这些情况的时候：</p>

<ul>
  <li>
    <p><strong>注册子类型：</strong> 如果方法签名只描述了父类型，但实际执行中用到了该类型的子类型，让Flink知道这些子类型能够提升不少性能。因此，在<code>StreamExecutionEnvironment</code>或<code>ExecutionEnvironment</code>中应当为每个子类型调用<code>.registerType(clazz)</code>方法。</p>
  </li>
  <li><strong>注册自定义序列化器：</strong> Flink会将自己不能处理的类型转交给<a href="https://github.com/EsotericSoftware/kryo">Kryo</a>,但并不是所有的类型都能被Kryo完美处理（也就是说：不是所有类型都能被Flink处理），比如，许多 Google Guava 的集合类型默认情况下是不能正常工作的。针对存在这个问题的这些类型，其解决方案
是通过在<code>StreamExecutionEnvironment</code> 或 <code>ExecutionEnvironment</code>中调用<code>.getConfig().addDefaultKryoSerializer(clazz, serializer)</code>方法，注册辅助的序列化器。许多库都提供了Kryo序列化器，关于自定义序列化器的更多细节请参考<a href="/1.2.0/dev/custom_serializers.html">Custom Serializers</a>。</li>
  <li>
    <p><strong>添加Type Hints：</strong> 有时，Flink尝试了各种办法仍不能推断出泛型，这时用户就必须通过借助<code>type hint</code>来推断泛型，一般这种情况只是在Java API中需要添加的。[Type Hints Section(#type-hints-in-the-java-api) 中讲解更为详细。</p>
  </li>
  <li><strong>手动创建一个 <code>TypeInformation</code>类：</strong> 在某些API中，手动创建一个<code>TypeInformation</code>类可能是必须的，因为Java泛型的类型擦除特性会使得Flink无法推断数据类型。更多详细信息可以参考<a href="#creating-a-typeinformation-or-typeserializer">Creating a TypeInformation or TypeSerializer</a></li>
</ul>

<h2 id="flinktypeinformation">FLink的TypeInformation类</h2>
<p><a href="https://github.com/apache/flink/blob/master//flink-core/src/main/java/org/apache/flink/api/common/typeinfo/TypeInformation.java">TypeInformation</a>类是所有类型描述类的基类。它包括了类型的一些基本属性，并可以通过它来生成序列化器（serializer），特殊情况下还可以生成类型的比较器。（<em>注意：Flink中的比较器不仅仅是定义大小顺序，更是处理keys的基本辅助工具</em>）</p>

<ul>
  <li>
    <p>基本类型：所有Java基本数据类型和对应装箱类型，加上<code>void</code>, <code>String</code>, <code>Date</code>, <code>BigDecimal</code>和 <code>BigInteger</code>.</p>
  </li>
  <li>
    <p>基本数组和对象数组</p>
  </li>
  <li>
    <p>复合类型：</p>

    <ul>
      <li>
        <p>Flink Java Tuples (Flink Java API的一部分): 最多25个成员，不支持null成员</p>
      </li>
      <li>
        <p>Scala <em>case 类</em> (包括 Scala tuples): 最多25个成员, 不支持null成员</p>
      </li>
      <li>
        <p>Row: 包含任意多个字段的元组并且支持null成员</p>
      </li>
      <li>
        <p>POJOs: 遵循类bean模式的类</p>
      </li>
    </ul>
  </li>
  <li>
    <p>辅助类型  (Option, Either, Lists, Maps, …)</p>
  </li>
  <li>
    <p>泛型: Flink自身不会序列化泛型，而是借助Kryo进行序列化.</p>
  </li>
</ul>

<p>POJO类非常有意思，因为POJO类可以支持复杂类型的创建，并且在定义keys时可以使用成员的名字：<code>dataSet.join(another).where("name").equalTo("personName")</code>。同时，POJO类对于运行时（runtime）是透明的，这使得Flink可以非常高效地处理它们。</p>

<h4 id="pojo">POJO类型的规则</h4>
<p>在满足如下条件时，Flink会将这种数据类型识别成POJO类型（并允许以成员名引用字段）：</p>

<ul>
  <li>该类是public的并且是独立的（即没有非静态的内部类）</li>
  <li>该类有一个public的无参构造方法</li>
  <li>该类（及该类的父类）的所有成员要么是public的，要么是拥有按照标准java bean命名规则命名的public getter和 public setter方法。</li>
</ul>

<h4 id="typeinformation">创建一个TypeInformation对象或序列化器</h4>
<p>创建一个TypeInformation对象时，不同编程语言的创建方法具体如下：</p>

<div class="codetabs">
  <div data-lang="java">
    <p>因为Java会对泛型的类型信息进行类型擦除，所以在需要在TypeInformation的构造方法中传入具体类型:
对于非泛型的类型, 你可以直接传入这个类:</p>

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">方法</span>
<span class="n">TypeInformation</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">info</span> <span class="o">=</span> <span class="n">TypeInformation</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></div>

    <p>对于泛型类型,你需要借助<code>TypeHint</code>去“捕获”泛型的类型信息:</p>

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">TypeInformation</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="n">info</span> <span class="o">=</span> <span class="n">TypeInformation</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="k">new</span> <span class="n">TypeHint</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;&gt;(){});</span></code></pre></div>

    <p>在内部，这个操作创建了一个TypeHint的匿名子类，用于捕获泛型信息，这个子类会一直保存到运行时。</p>
  </div>

  <div data-lang="scala">
    <p>在Scala中，Flink使用在编译时运行的<em>宏</em>，在宏可供调用时去捕获所有泛型信息。</p>

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// 重要: 为了能够访问&#39;createTypeInformation&#39; 的宏方法，这个import是必须的</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.api.scala._</span>

<span class="k">val</span> <span class="n">stringInfo</span><span class="k">:</span> <span class="kt">TypeInformation</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">createTypeInformation</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>

<span class="k">val</span> <span class="n">tupleInfo</span><span class="k">:</span> <span class="kt">TypeInformation</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Double</span><span class="o">)]</span> <span class="k">=</span> <span class="n">createTypeInformation</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Double</span><span class="o">)]</span></code></pre></div>

    <p>你也可以在Java使用相同的方法作为备选。</p>
  </div>
</div>

<p>为了创建一个<code>序列化器（TypeSerializer）</code>，只需要在<code>TypeInformation</code> 对象上调用<code>typeInfo.createSerializer(config)</code>方法。</p>

<p><code>config</code>参数的类型是<code>ExecutionConfig</code>，它保留了程序的注册的自定义序列化器的相关信息。在可能用到TypeSerializer的地方，尽量传入程序的ExecutionConfig，你可以调用<code>DataStream</code> 或 <code>DataSet</code>的 <code>getExecutionConfig()</code>方法获取ExecutionConfig。一些内部方法（如：<code>MapFunction</code>）中，你可以通过将该方法变成一个<a href="">Rich Function</a>，然后调用<code>getRuntimeContext().getExecutionConfig()</code>获取ExecutionConfig.</p>

<hr />
<hr />

<h2 id="scala-api">Scala API中的类型信息</h2>
<p>通过<em>类型清单(manifests)</em> and <em>类标签</em>功能，Scala对于运行时的类型信息有着非常详细的概念。通常，Scala对象的类型和方法可以访问其泛型参数的类型，因此，Scala程序不会有Java程序那样的类型擦除问题。</p>

<p>此外，Scala允许通过Scala的宏在Scala编译器中运行自定义代码，这意味着当你编译针对Flink的Scala API编写的Scala程序时，会执行一些Flink代码。
在编译期间，我们使用宏来查看所有用户方法的参数类型和返回类型，编译期也是所有类型信息完全可用的时候。在宏中，我们为方法的返回类型（或参数类型）创建一个<em>TypeInformation</em>，并将其作为方法的一部分。</p>

<h4 id="evidence-parameter">无隐式值导致的证据参数（Evidence Parameter）错误</h4>
<p>如果无法创建TypeInformation，程序编译报错：“could not find implicit value for evidence parameter of type TypeInformation”。</p>

<p>常见的原因是生成TypeInformation的代码没有被导入，请确保导入了完整的flink.api.scala包。</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.flink.api.scala._</span></code></pre></div>

<p>另外一个常见原因是泛型方法，这种情况可以通过下面的方法进行修复。</p>

<h4 id="section-1">泛型方法</h4>

<p>思考下面这个例子：</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">selectFirst</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">input</span><span class="k">:</span> <span class="kt">DataSet</span><span class="o">[(</span><span class="kt">T</span>, <span class="k">_</span><span class="o">)])</span> <span class="k">:</span> <span class="kt">DataSet</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">v</span> <span class="k">=&gt;</span> <span class="n">v</span><span class="o">.</span><span class="n">_1</span> <span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">data</span> <span class="k">:</span> <span class="kt">DataSet</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)</span> <span class="kt">=</span> <span class="kt">...</span>

<span class="kt">val</span> <span class="kt">result</span> <span class="kt">=</span> <span class="kt">selectFirst</span><span class="o">(</span><span class="kt">data</span><span class="o">)</span></code></pre></div>

<p>例子中的这种泛型方法，方法参数和返回类型的数据类型对每次调用可能不一样，并且定义方法的地方也不知道。这就会导致上面的代码产生一个没有足够的隐式证据可用的错误。</p>

<p>在这种情况下，类型信息必须在调用的地方生成并传给方法。Scala为此提供了<em>隐式参数</em>。</p>

<p>下面的代码告诉Scala把<em>T</em>的类型信息带入方法，然后类型信息会在方法被调用的地方生成，而不是在方法定义的位置生成。</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">selectFirst</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">TypeInformation</span><span class="o">](</span><span class="n">input</span><span class="k">:</span> <span class="kt">DataSet</span><span class="o">[(</span><span class="kt">T</span>, <span class="k">_</span><span class="o">)])</span> <span class="k">:</span> <span class="kt">DataSet</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">v</span> <span class="k">=&gt;</span> <span class="n">v</span><span class="o">.</span><span class="n">_1</span> <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<hr />
<hr />

<h2 id="java-api">Java API中的类型信息</h2>
<p>一般情况下，Java会擦除泛型的类型信息。Flink会尝试使用Java的保留字节（主要是方法签名和子类信息），通过反射重建尽可能多的类型信息， 这个逻辑还包含了一些简单的类型推断，比如方法的返回类型取决于其输入类型的情况：</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppendOne</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">MapFunction</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;(</span><span class="n">value</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>某些情况下，Flink不能重建所有的类型信息。此时，用户必须通过<em>type hints</em>获得帮助。</p>

<h4 id="java-api-1">Java API中的类型提示</h4>

<p>为了解决Flink无法重建被清除的泛型信息的情况, Java API提供了所谓的<em>(类型提示)type hint</em>. 类型提示告诉系统由方法生成的数据流或数据集的类型，如:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataSet</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">dataSet</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="n">MyGenericNonInferrableFunction</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">SomeType</span><span class="o">&gt;())</span>
        <span class="o">.</span><span class="na">returns</span><span class="o">(</span><span class="n">SomeType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></div>

<p>由<code>return</code>方法指定生成的类型，在本例中是通过一个类。type hint支持以下方式定义类型：
* 类，针对无参数的类型（非泛型）
* 以TypeHints的形式返回<code>returns(new TypeHint&lt;Tuple2&lt;Integer, SomeType&gt;&gt;(){})</code>。
 <code>TypeHint</code>类可以捕获泛型信息，并将其保留至运行时（通过匿名子类）。</p>

<h4 id="java-8-lambda">针对Java 8 Lambda表达式的类型抽取</h4>
<p>由于Lambda表达式不涉及继承方法接口的实现类，Java 8 Lambda的类型抽取与非lambda表达式的工作方式并不相同。</p>

<p>当前，Flink正在尝试如何实现Lambda表达式，并使用Java的泛型签名（generic signature）来决定参数类型和返回类型。但是， 并不是所有的编译器都为Lambda 表达式生成了签名（本文写作时只有 Eclipse JDT编译器 4.5 以上版本支持了）</p>

<h4 id="pojo-1">POJO类型的序列化</h4>

<p>PojoTypeInfomation类用于创建针对POJO对象中所有成员的序列化器。Flink自带了针对诸如int，long，String等标准类型的序列化器，对于所有其他的类型，我们交给Kryo处理。</p>

<p>如果Kryo不能处理某种类型，我们可以通过PojoTypeInfo去调用Avro来序列化POJO，为了这样处理，我们必须调用如下接口：</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">ExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="n">env</span><span class="o">.</span><span class="na">getConfig</span><span class="o">().</span><span class="na">enableForceAvro</span><span class="o">();</span></code></pre></div>

<p>注意：Flink会用Avro序列化器自动序列化由Avro产生POJO对象。</p>

<p>如果你想使得整个POJO类型都交给Kryo序列化器处理，则你需要配置：</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">ExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="n">env</span><span class="o">.</span><span class="na">getConfig</span><span class="o">().</span><span class="na">enableForceKryo</span><span class="o">();</span></code></pre></div>

<p>如果Kryo不能序列化该POJO对象，你可以添加一个自定义序列化器到Kryo，使用代码如下：</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">env</span><span class="o">.</span><span class="na">getConfig</span><span class="o">().</span><span class="na">addDefaultKryoSerializer</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Serializer</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">serializerClass</span><span class="o">)</span></code></pre></div>

<p>这些方法还有许多不同的重载形式可用</p>

<h2 id="kryo-">禁用 Kryo 作为备选</h2>

<p>在某些情况下，程序可能希望明确地避免使用Kryo作为泛型类型的备选。 最常见的情况是想确保所有类型都可以通过Flink自己的序列化器或通过用户定义的自定义序列器有效序列化。</p>

<p>当遇到需要通过Kryo序列化的数据类型时，以下设置会引发异常:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">env</span><span class="o">.</span><span class="na">getConfig</span><span class="o">().</span><span class="na">disableGenericTypes</span><span class="o">();</span></code></pre></div>

<h2 id="section-2">使用工厂定义类型信息</h2>
<p>类型信息工厂允许以插件的形式自定义类型信息到 Flink 类型系统中，你需要实现<code>org.apache.flink.api.common.typeinfo.TypeInfoFactory</code> 用于返回你自定义类型信息。
当对应的类型已经注解了<code> @org.apache.flink.api.common.typeinfo.TypeInfo</code>，那么在类型提取阶段 Flink 就会调用你实现的工厂。</p>

<p>类型信息工厂在Java和Scala API中均可使用。</p>

<p>在类型的层次结构中，在向上层（子类往父类）移动的过程中会选择最近的工厂，但是内置的工厂具有最高的层次。一个工厂可以比Flink的内置类型还有更高的层次，所以你应该知道你在做什么。</p>

<p>下面的例子展示了在Java中如何注解一个自定义类型<code>MyTuole</code>，并且通过工厂创建自定义的类型信息对象。</p>

<p>注解后的自定义类型:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@TypeInfo</span><span class="o">(</span><span class="n">MyTupleTypeInfoFactory</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTuple</span><span class="o">&lt;</span><span class="n">T0</span><span class="o">,</span> <span class="n">T1</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">T0</span> <span class="n">myfield0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">T1</span> <span class="n">myfield1</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>

<p>利用工厂创建自定义类型信息对象:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTupleTypeInfoFactory</span> <span class="kd">extends</span> <span class="n">TypeInfoFactory</span><span class="o">&lt;</span><span class="n">MyTuple</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">TypeInformation</span><span class="o">&lt;</span><span class="n">MyTuple</span><span class="o">&gt;</span> <span class="nf">createTypeInfo</span><span class="o">(</span><span class="n">Type</span> <span class="n">t</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">TypeInformation</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">genericParameters</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MyTupleTypeInfo</span><span class="o">(</span><span class="n">genericParameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;T0&quot;</span><span class="o">),</span> <span class="n">genericParameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;T1&quot;</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p><code>createTypeInfo(Type, Map&lt;String, TypeInformation&lt;?&gt;&gt;)</code>方法用于创建该工厂针对类型的类型信息，参数和类型的泛型参数可以提供关于该类型的附加信息（如果有参数）。</p>

<p>如果你的类型包含的泛型参数可能源自Flink方法的输入类型，请确保你实现了<code>org.apache.flink.api.common.typeinfo.TypeInformation#getGenericParameters</code> 
用于建立从泛型参数到类型信息的双向映射。</p>


 <div class="footer">
  发现错误？想参与编辑？
  <a href="https://github.com/flink-china/flink-china-doc/edit/1.2.0/dev/types_serialization.md" target="_blank">
    在 Github 上编辑此页！
  </a>
</div>

        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/1.2.0/page/js/flink.js"></script>

   <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?835985ad7943d8c24bc3c1f155b7d4a2";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>

    <!-- Disqus -->
    
  </body>
</html>
